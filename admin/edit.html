<style>
    .zt-edit-content {
        height: 600px;
        padding: 20px;
    }

    label {
        font-size: 14px;
        font-weight: bold;
    }

    .zt-selected {
        border: 1px solid #cecece !important;
        border-radius: 5px;
        background: #EEF1FF;
    }

    .zt-item {
        cursor: pointer;
        overflow: hidden;
        width: 152px;
        height: 229px;
        margin: 4px;
        float: left;
        border: 1px solid #fff;
        padding: 5px 5px;
        position: relative;

    }

    .zt-item:hover {
        border: 1px solid #fff !important;
        border-radius: 5px;
        background: #CCCCCC;

    }

    .zt-selected:hover {
        border: 1px solid #cecece !important;
        border-radius: 5px;
        background: #EEF1FF;
    }

    .zt-item:hover:before {

        content: 'USE STORY';
        position: absolute;
        text-align: center;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        color: #fff;
        font-weight: bold;
        font-size: 14px;
    }

    .zt-selected:hover:before {
        content: '';
    }

    .zt-item img {
        /*margin-left: 20%;*/
        /*height: 150px*/
        height: 165px;
        display: block;
        margin: auto;
    }

    .zt-item p {
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        white-space: normal;
        margin-top: 4px;
    }

    .zt-list {
        overflow: scroll;
        height: 88%;
    }

    .zt-item a {
        color: #929292;
        text-decoration: none;
        cursor: pointer;

    }

    .zt-item a:first-child {
        margin-left: 20px;
    }

    .zt-item a:last-child {
        float: right;
        margin-right: 20px;
    }

    .zt-item > .zt-buttons {
        position: absolute;
        bottom: 2px;
        width: 100%;
    }

    .zt-actions .zt-btn {
        margin: 0;
        padding-left: 10px;
        padding-right: 10px;
        position: relative;
    }

    .zt-btn.zt-btn-blue-light {
        color: white;
        background: #1e73bc;
    }

    .zt-btn {
        display: inline-block;
        margin: 35px 0;
        padding: 4px 0px;
        line-height: 30px;
        color: #ffffff;
        background-color: #1f242b;
        border: none;
        text-align: center;
        text-decoration: none;
        -webkit-border-radius: 3px;
        -moz-border-radius: 3px;
        border-radius: 3px;
        font-size: 14px;
        width: 100%;
        cursor: pointer;
    }

    .zt-actions {
        width: 130px;
        float: right;
        margin-right: 41px;
        margin-top: -10px
    }

    .zt-use-story {
        cursor: pointer;
    }

    .zt-button-frame {
        position: fixed;
        top: 0px;
        left: 0px;
        width: 100vw;
        height: 100vh;
        background-color: black;
        background-image: url({PLUGIN_URL}/assets/images/logo-loading-dark-bg-200x.gif);
        background-size: 10%;
        z-index: 2147483647;
        background-position: center center;
        background-repeat: no-repeat;
        border-width: initial;
        border-style: none;
        border-color: initial;
        border-image: initial;
    }

    .zt-fadeInWidget {
        animation: fadeInWidgetAnim 0.3s ease 0s 1 normal none running;
    }

    .zt-close-amp {
        width: 30px;
        height: 30px;
        color: white;
        font-family: "Open Sans", sans-serif;
        position: absolute;
        top: 5px;
        font-size: 20px;
        left: 10px;
        cursor: pointer;
        text-shadow: rgb(150, 150, 150) 1px 1px 11px;
    }

    .zt-external {
        position: fixed !important;
        z-index: 2147483647 !important;
    }

    .zt-close-amp {
        width: 20px;
        height: 20px;
        color: white;
        font-family: "Open Sans", sans-serif;
        position: absolute;
        top: 5px;
        font-size: 20px;
        left: 10px;
        cursor: pointer;
        text-shadow: rgb(150, 150, 150) 1px 1px 11px;
        background-image: url(data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTguMS4xLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgdmlld0JveD0iMCAwIDIxMi45ODIgMjEyLjk4MiIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMjEyLjk4MiAyMTIuOTgyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgd2lkdGg9IjY0cHgiIGhlaWdodD0iNjRweCI+CjxnIGlkPSJDbG9zZSI+Cgk8cGF0aCBzdHlsZT0iZmlsbC1ydWxlOmV2ZW5vZGQ7Y2xpcC1ydWxlOmV2ZW5vZGQ7IiBkPSJNMTMxLjgwNCwxMDYuNDkxbDc1LjkzNi03NS45MzZjNi45OS02Ljk5LDYuOTktMTguMzIzLDAtMjUuMzEyICAgYy02Ljk5LTYuOTktMTguMzIyLTYuOTktMjUuMzEyLDBsLTc1LjkzNyw3NS45MzdMMzAuNTU0LDUuMjQyYy02Ljk5LTYuOTktMTguMzIyLTYuOTktMjUuMzEyLDBjLTYuOTg5LDYuOTktNi45ODksMTguMzIzLDAsMjUuMzEyICAgbDc1LjkzNyw3NS45MzZMNS4yNDIsMTgyLjQyN2MtNi45ODksNi45OS02Ljk4OSwxOC4zMjMsMCwyNS4zMTJjNi45OSw2Ljk5LDE4LjMyMiw2Ljk5LDI1LjMxMiwwbDc1LjkzNy03NS45MzdsNzUuOTM3LDc1LjkzNyAgIGM2Ljk4OSw2Ljk5LDE4LjMyMiw2Ljk5LDI1LjMxMiwwYzYuOTktNi45OSw2Ljk5LTE4LjMyMiwwLTI1LjMxMkwxMzEuODA0LDEwNi40OTF6IiBmaWxsPSIjRkZGRkZGIi8+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPC9zdmc+Cg==);
        background-size: cover;

    }

    .zt-external {
        position: fixed !important;
        z-index: 2147483647 !important;
    }


</style>
<div class="zt-edit-content">
    <br>
    <input type="checkbox" name="ztorie_enabled" id="zt-replace" {ZTORIE_ENABLED}>
    <label for="zt-replace"> Show AMP Story instead of {TYPE_NAME}.</label>
    <div class="zt-actions"><a class="zt-btn zt-btn-blue-light" href="https://app.ztorie.com/dashboard">Create story</a></div>
    <h3>Choose a story to add</h3>
    <div class="zt-list">
        <input type="hidden" name="ztorie_code" value="{SELECTED_CODE}">
        {EDIT_CONTENT}
    </div>
</div>
<div id="zt-preview-popup">

</div>
<div class="zt-close-amp zt-external" style="display: none;"></div>

<script>
    var pluginUrl = '{PLUGIN_URL}';
</script>
{POPUP_SCRIPT}
<script>

    document.addEventListener('DOMContentLoaded', function () {
        jQuery('.zt-item').click(function (e) {
            if (e.target.tagName != "A") {

                e.preventDefault();
                jQuery('.zt-item').removeClass('zt-selected');
                let elem = jQuery(this);
                elem.addClass('zt-selected');

                jQuery("input[name*='ztorie_code']").val(elem.find("input[name=code]").val());
                jQuery('#zt-replace').prop('checked', true);
                changeAmpStatus('Enabled');

                let title = elem.find("input[name=title]").val();
                let seoTitle = elem.find("input[name=seo_title]").val();
                if (seoTitle.length)
                    jQuery('#editable-post-name').text(seoTitle);
                if (title.length)
                    jQuery('#title').val(title);

                return false;
            }
        });

        jQuery('.zt-preview').click(function () {
            ztOpenPreview(this);
        });

        jQuery('.zt-close-amp').click(function () {
            jQuery('#zt-preview-popup').html('');
            jQuery('.zt-close-amp').hide();
        });

    });

    function ztOpenPreview(e) {

        let elem = jQuery(e).parent().parent();
        let iframe = "<iframe src=\"https://share.ztorie.com/amp/" + elem.find("input[name=code]").val() + "\" class=\"zt-button-frame zt-fadeInWidget\"></iframe>";
        jQuery('#preview-popup').html(iframe);
        jQuery('.zt-close-amp').show();
    }


    function ztSelectZtoriePost(elem) {

        let codeInput = jQuery("input[name=ztorie_post_code]");
        let currCode = jQuery(elem).find("input[name=code]").val();

        let selected = JSON.parse(codeInput.val());

        if (selected.indexOf(currCode) !== -1) {
            console.log(selected.indexOf(currCode));
            selected.splice(selected.indexOf(currCode));
            jQuery(elem).removeClass('zt-selected');
        } else {
            selected.push(currCode);
            jQuery(elem).addClass('zt-selected');
        }
        codeInput.val(JSON.stringify(selected));
    }

</script>